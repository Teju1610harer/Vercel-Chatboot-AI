<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI Chatbot</title>
<style>
  body {
    margin: 0;
    font-family: monospace;
    background: #f5f5f5;
    transition: 0.3s;
  }
  body.dark {
    background: #0f0f0f;
    color: #e5e5e5;
  }
  .chat {
    max-width: 800px;
    margin: auto;
    padding: 20px;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .messages {
    margin: 20px 0;
  }
  .msg {
    margin: 10px 0;
    padding: 10px 14px;
    border-radius: 8px;
    white-space: pre-wrap;
  }
  .user {
    background: #007bff;
    color: white;
    text-align: right;
  }
  .bot {
    background: #e0e0e0;
    color: black;
  }
  body.dark .bot {
    background: #1f1f1f;
    color: #e5e5e5;
  }
  .input-box {
    display: flex;
    gap: 10px;
  }
  input {
    flex: 1;
    padding: 10px;
    font-family: monospace;
  }
  button {
    padding: 10px 16px;
    cursor: pointer;
  }
</style>
</head>

<body>
<div class="chat">
  <div class="header">
    <h2>AI Chat</h2>
    <button onclick="toggleDark()">ðŸŒ™</button>
  </div>

  <div class="messages" id="messages"></div>

  <div class="input-box">
    <input id="input" placeholder="Type a message..." />
    <button onclick="send()">Send</button>
  </div>
</div>

<script>
let history = JSON.parse(localStorage.getItem("chatHistory") || "[]");

const messagesDiv = document.getElementById("messages");
const input = document.getElementById("input");

function renderHistory() {
  messagesDiv.innerHTML = "";
  history.forEach(m => addMessage(m.role, m.content));
}

function addMessage(role, text) {
  const div = document.createElement("div");
  div.className = "msg " + (role === "user" ? "user" : "bot");
  div.textContent = text;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
  return div;
}

function typeEffect(element, text) {
  let i = 0;
  element.textContent = "";
  const interval = setInterval(() => {
    element.textContent += text[i++];
    if (i >= text.length) clearInterval(interval);
  }, 20);
}

async function send() {
  const msg = input.value.trim();
  if (!msg) return;

  input.value = "";
  history.push({ role: "user", content: msg });
  addMessage("user", msg);

  const botDiv = addMessage("bot", "...");
  
  const res = await fetch("/api/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: msg, history })
  });

  const data = await res.json();
  botDiv.textContent = "";
  typeEffect(botDiv, data.reply);

  history.push({ role: "assistant", content: data.reply });
  localStorage.setItem("chatHistory", JSON.stringify(history));
}

function toggleDark() {
  document.body.classList.toggle("dark");
}

renderHistory();
</script>
</body>
</html>
